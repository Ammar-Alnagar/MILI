"""
Core type definitions for MILI GPU kernels.
Simplified types for basic GPU computation.
"""

# ============================================================================
# Basic Data Types
# ============================================================================

struct DType:
    """Simple data type enumeration."""
    var value: Int32

    fn __init__(value: Int32) -> Self:
        return Self {value: value}

    @staticmethod
    fn float32() -> DType:
        return DType(0)

    @staticmethod
    fn float16() -> DType:
        return DType(1)

# ============================================================================
# GPU Configuration
# ============================================================================

struct GPUConfig:
    """GPU execution configuration."""
    var block_size_x: Int32
    var block_size_y: Int32
    var block_size_z: Int32
    var shared_memory_bytes: Int32
    var grid_size_x: Int32
    var grid_size_y: Int32
    var grid_size_z: Int32

    fn __init__(
        block_size_x: Int32 = 256,
        block_size_y: Int32 = 1,
        block_size_z: Int32 = 1,
        shared_memory_bytes: Int32 = 0,
        grid_size_x: Int32 = 1,
        grid_size_y: Int32 = 1,
        grid_size_z: Int32 = 1,
    ) -> Self:
        return Self {
            block_size_x: block_size_x,
            block_size_y: block_size_y,
            block_size_z: block_size_z,
            shared_memory_bytes: shared_memory_bytes,
            grid_size_x: grid_size_x,
            grid_size_y: grid_size_y,
            grid_size_z: grid_size_z
        }

    fn total_threads_per_block(self) -> Int32:
        """Calculate total threads per block."""
        return self.block_size_x * self.block_size_y * self.block_size_z

# ============================================================================
# Tensor Metadata
# ============================================================================

struct TensorShape:
    """Tensor shape information."""
    var batch: Int32
    var seq_len: Int32
    var height: Int32
    var width: Int32

    fn __init__(batch: Int32, seq_len: Int32, height: Int32, width: Int32) -> Self:
        return Self {batch: batch, seq_len: seq_len, height: height, width: width}

    fn total_elements(self) -> Int32:
        """Get total number of elements."""
        return self.batch * self.seq_len * self.height * self.width

struct TensorMetadata:
    """Complete tensor metadata."""
    var shape: TensorShape
    var dtype: DType
    var batch_size: Int32
    var seq_length: Int32
    var num_heads: Int32
    var head_dim: Int32
    var num_kv_heads: Int32
    var vocab_size: Int32

    fn __init__(
        batch_size: Int32,
        seq_length: Int32,
        num_heads: Int32,
        head_dim: Int32,
        num_kv_heads: Int32,
        vocab_size: Int32,
        dtype: DType = DType.float32()
    ) -> Self:
        var shape = TensorShape(
            batch=batch_size,
            seq_len=seq_length,
            height=num_heads,
            width=head_dim
        )
        return Self {
            shape: shape,
            dtype: dtype,
            batch_size: batch_size,
            seq_length: seq_length,
            num_heads: num_heads,
            head_dim: head_dim,
            num_kv_heads: num_kv_heads,
            vocab_size: vocab_size
        }

    fn hidden_size(self) -> Int32:
        """Get hidden size (num_heads * head_dim)."""
        return self.num_heads * self.head_dim

# ============================================================================
# Kernel Status
# ============================================================================

struct KernelStatus:
    """Kernel execution status."""
    var success: Bool
    var error_code: Int32

    fn __init__(success: Bool = True, error_code: Int32 = 0) -> Self:
        return Self {success: success, error_code: error_code}

    fn is_success(self) -> Bool:
        return self.success

    fn get_error_code(self) -> Int32:
        return self.error_code